# í…”ë ˆê·¸ë¨ í”„ë¡œì„¸ìŠ¤ ì •ë°€ ë¶„ì„ ë³´ê³ ì„œ

**ë¶„ì„ì¼**: 2026-02-12  
**ë¶„ì„ ëŒ€ìƒ**: í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡/ìˆ˜ì‹  ì§€ì—° ë° ëŒ€ì‹œë³´ë“œ ë¯¸í‘œì‹œ ë¬¸ì œ

---

## 1. ì „ì²´ ì•„í‚¤í…ì²˜ ìš”ì•½

```
[íšŒì› í…”ë ˆê·¸ë¨ ì•±]
    â†• (Webhook)
[Telegram API Server]
    â†• (HTTPS POST)
[Google Apps Script - doPost()]
    â†’ handleTelegramWebhook_()
        â†’ SpreadsheetApp.openById() (â˜… ë³‘ëª©)
        â†’ telegram_requests ì‹œíŠ¸ì— appendRow
        â†’ telegramSendMessage() (ì‘ë‹µ ì „ì†¡)
    â† ContentService "OK"

[ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (index.html + js-app.html)]
    â†’ google.script.run.listTelegramRequests('PENDING')
        â†’ SpreadsheetApp.openById() (â˜… ë³‘ëª©)
        â†’ telegram_requests ì‹œíŠ¸ ì „ì²´ ì½ê¸°
        â†’ items ì‹œíŠ¸ ì „ì²´ ì½ê¸° (JOIN)
    â† renderTelegramRequests_()
```

---

## 2. ë¬¸ì œ 1: íšŒì› ë©”ì‹œì§€ ì „ì†¡ 3ë¶„ ì´ìƒ ì†Œìš”

### 2.1 ì›ì¸ ë¶„ì„

íšŒì›ì´ í…”ë ˆê·¸ë¨ì—ì„œ **ì…ì°°í™•ì •/ì…ì°°ì·¨ì†Œ** ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‹¤ìŒ í”Œë¡œìš°ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤:

#### í”Œë¡œìš° (BID_CONFIRM â†’ BID_YES)

1. **1ë‹¨ê³„**: íšŒì›ì´ `ì…ì°°í™•ì •` ë²„íŠ¼ í´ë¦­ â†’ `callback_data: MJ|BID_CONFIRM|{itemId}`
2. **2ë‹¨ê³„**: ì„œë²„ê°€ "ì…ì°°í™•ì • í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" í™•ì¸ ë©”ì‹œì§€ ì „ì†¡ (ì˜ˆ/ì•„ë‹ˆì˜¤ ë²„íŠ¼)
3. **3ë‹¨ê³„**: íšŒì›ì´ `ì˜ˆ` í´ë¦­ â†’ `callback_data: MJ|BID_YES|{itemId}|{messageId}`
4. **4ë‹¨ê³„**: ì„œë²„ê°€ DB ì²˜ë¦¬ í›„ ì‘ë‹µ ë©”ì‹œì§€ ì „ì†¡

### 2.2 í•µì‹¬ ë³‘ëª© ì§€ì  (BID_YES í•¸ë“¤ëŸ¬, TelegramService.js:227-287)

```
BID_YES ì²˜ë¦¬ ì‹œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…:
â”œâ”€â”€ telegramAnswerCallbackQuery_()     â†’ Telegram API í˜¸ì¶œ #1 (~0.5ì´ˆ)
â”œâ”€â”€ SpreadsheetApp.openById()          â†’ â˜…â˜…â˜… ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—´ê¸° (~2-5ì´ˆ)
â”œâ”€â”€ items ì‹œíŠ¸ TextFinder ê²€ìƒ‰         â†’ ì‹œíŠ¸ I/O (~1-3ì´ˆ)
â”œâ”€â”€ telegram_requests ì‹œíŠ¸ ì—´ê¸°/ìƒì„±    â†’ ì‹œíŠ¸ I/O (~0.5-2ì´ˆ)
â”œâ”€â”€ appendRow()                        â†’ ì‹œíŠ¸ ì“°ê¸° (~1-3ì´ˆ)
â”œâ”€â”€ telegramSendMessage() (ëŒ“ê¸€)       â†’ Telegram API í˜¸ì¶œ #2 (~0.5ì´ˆ)
â””â”€â”€ telegramDeleteMessage_() (í™•ì¸ ì‚­ì œ) â†’ Telegram API í˜¸ì¶œ #3 (~0.5ì´ˆ)
```

**ì´ ì˜ˆìƒ ì†Œìš” ì‹œê°„: 6~14ì´ˆ** (ì •ìƒ ì‹œ)

### 2.3 3ë¶„ ì´ìƒ ì§€ì—°ì˜ ì‹¤ì œ ì›ì¸ë“¤

#### ğŸ”´ ì›ì¸ A: Google Apps Script ì½œë“œ ìŠ¤íƒ€íŠ¸ (Cold Start)
- GAS ì›¹ì•±ì€ ì¼ì • ì‹œê°„ ë¯¸ì‚¬ìš© ì‹œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¢…ë£Œë¨
- ë‹¤ì‹œ í˜¸ì¶œ ì‹œ **ì½œë“œ ìŠ¤íƒ€íŠ¸**ë¡œ 30ì´ˆ~2ë¶„ ì†Œìš” ê°€ëŠ¥
- `doPost()` â†’ `handleTelegramWebhook_()` ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í•„ìš”

#### ğŸ”´ ì›ì¸ B: Telegram ì›¹í›… ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- Telegramì€ ì›¹í›… ì‘ë‹µì´ **ëŠ¦ìœ¼ë©´ ë™ì¼ ì—…ë°ì´íŠ¸ë¥¼ ì¬ì‹œë„**í•¨
- `doPost()`ê°€ ëŠë¦¬ë©´ Telegramì´ ê°™ì€ ìš”ì²­ì„ ì—¬ëŸ¬ ë²ˆ ë³´ëƒ„
- `markProcessedOnce_()` ìºì‹œë¡œ ì¤‘ë³µ ë°©ì§€í•˜ì§€ë§Œ, **ê° ì¬ì‹œë„ë§ˆë‹¤ GAS ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒˆë¡œ ëœ¸**
- ê²°ê³¼: ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ê°€ ë™ì‹œì— ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì ‘ê·¼ â†’ **Lock ê²½í•©**

#### ğŸ”´ ì›ì¸ C: SpreadsheetApp.openById() ë°˜ë³µ í˜¸ì¶œ
- `handleTelegramWebhook_()` ë‚´ë¶€ì—ì„œ `SpreadsheetApp.openById(SPREADSHEET_ID)` ì§ì ‘ í˜¸ì¶œ
- ì´ë¯¸ ìµœì í™”ë˜ì–´ 1íšŒë§Œ í˜¸ì¶œí•˜ì§€ë§Œ, **GAS ì‹¤í–‰ í™˜ê²½ ìì²´ì˜ ì´ˆê¸°í™” ì‹œê°„**ì´ ë¬¸ì œ

#### ğŸŸ¡ ì›ì¸ D: encodeURIComponent on Bot Token
- [`telegramApiUrl_()`](TelegramService.js:17)ì—ì„œ ë´‡ í† í°ì— `encodeURIComponent()` ì ìš©
- ë´‡ í† í°ì— `:` ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ `%3A`ë¡œ ì¸ì½”ë”©ë˜ì–´ **API í˜¸ì¶œ ì‹¤íŒ¨ ê°€ëŠ¥**
- ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§ ì—†ì´ ì—ëŸ¬ throw â†’ ì „ì²´ ì²˜ë¦¬ ì§€ì—°

#### ğŸŸ¡ ì›ì¸ E: CacheService ì§€ì—°
- [`markProcessedOnce_()`](TelegramService.js:122-133)ì—ì„œ `CacheService.getScriptCache()` ì‚¬ìš©
- GAS CacheServiceëŠ” ê°„í—ì ìœ¼ë¡œ **500ms~2ì´ˆ ì§€ì—°** ë°œìƒ

### 2.4 ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ (ì§€ì—° ë°œìƒ ì‹œ)

```
íšŒì› â†’ Telegram â†’ GAS doPost (ì½œë“œìŠ¤íƒ€íŠ¸ 30-120ì´ˆ)
                    â†“
              handleTelegramWebhook_
                    â†“
              CacheService.getScriptCache() (0.5-2ì´ˆ)
                    â†“
              telegramAnswerCallbackQuery_ (0.5ì´ˆ)
                    â†“
              SpreadsheetApp.openById (2-5ì´ˆ)
                    â†“
              items ì‹œíŠ¸ TextFinder (1-3ì´ˆ)
                    â†“
              telegram_requests appendRow (1-3ì´ˆ)
                    â†“
              telegramSendMessage (0.5ì´ˆ)
                    â†“
              telegramDeleteMessage_ (0.5ì´ˆ)
                    â†“
              return â†’ doPost returns "OK"
```

**ìµœì•…ì˜ ê²½ìš°**: ì½œë“œìŠ¤íƒ€íŠ¸(120ì´ˆ) + DBì‘ì—…(14ì´ˆ) + APIí˜¸ì¶œ(1.5ì´ˆ) = **~136ì´ˆ (ì•½ 2ë¶„ 16ì´ˆ)**

Telegram ì¬ì‹œë„ê¹Œì§€ í¬í•¨í•˜ë©´ **3ë¶„ ì´ìƒ** ì¶©ë¶„íˆ ê°€ëŠ¥.

---

## 3. ë¬¸ì œ 2: DBì— ìš”ì²­ì´ ë“¤ì–´ì˜¤ì§€ë§Œ ëŒ€ì‹œë³´ë“œì— ë³´ì´ì§€ ì•ŠìŒ

### 3.1 ì›ì¸ ë¶„ì„

#### ğŸ”´ ì›ì¸ A: ë‘ ê°€ì§€ ë‹¤ë¥¸ DB ì“°ê¸° ê²½ë¡œ ì¡´ì¬ (í•µì‹¬ ë¬¸ì œ!)

**ê²½ë¡œ 1** - `handleTelegramWebhook_()` (TelegramService.js:258-271):
```javascript
// telegram_requests ì‹œíŠ¸ì— ë°”ë¡œ ë“±ë¡
var reqSheet = ss.getSheetByName(TELEGRAM_REQUESTS_SHEET_NAME);
if (!reqSheet) {
  reqSheet = ss.insertSheet(TELEGRAM_REQUESTS_SHEET_NAME);
  reqSheet.getRange(1, 1, 1, 11).setValues([['req_id','requested_at','action','status',
    'item_id','member_id','chat_id','telegram_username','note','approved_at','approved_by']]);
}
reqSheet.appendRow([
  reqId, requestedAt, reqAction, 'PENDING',
  String(itemId), memberId, chatId, username,
  JSON.stringify({ origin_message_id: originMessageId || '' }),
  '', ''
]);
```

**ê²½ë¡œ 2** - `createTelegramRequest()` (SheetDB.js:992-1045):
```javascript
// ensureTelegramRequestsSheet_() í˜¸ì¶œ â†’ í—¤ë” ê²€ì¦/ë³´ì¥
const sheet = ensureTelegramRequestsSheet_();
// ... ê²€ì¦ ë¡œì§ ...
sheet.appendRow([...]);
```

**âš ï¸ ë¬¸ì œ**: ê²½ë¡œ 1(TelegramService.js)ì€ `ensureTelegramRequestsSheet_()`ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³  **ì§ì ‘ ì‹œíŠ¸ë¥¼ ì—´ì–´ì„œ ì“°ê¸°**í•©ë‹ˆë‹¤. ì´ ê²½ìš°:
- í—¤ë”ê°€ ì—†ê±°ë‚˜ ë‹¤ë¥´ë©´ ë°ì´í„°ê°€ ì˜ëª»ëœ ì—´ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ
- `SpreadsheetApp.flush()`ê°€ í˜¸ì¶œë˜ì§€ ì•Šì•„ **ì“°ê¸°ê°€ ì§€ì—°**ë  ìˆ˜ ìˆìŒ

#### ğŸ”´ ì›ì¸ B: listTelegramRequests()ì˜ status í•„í„°ë§ ë¬¸ì œ

[`listTelegramRequests()`](SheetDB.js:1048-1121)ì—ì„œ:
```javascript
var st = String(r[3] || '').trim().toUpperCase();
if (!st) st = 'PENDING';
if (s && s !== 'ALL' && st !== s) continue;
```

- `r[3]`ì€ **4ë²ˆì§¸ ì—´(status)**ì„ ì½ìŒ
- ë§Œì•½ ê²½ë¡œ 1ì—ì„œ í—¤ë”ê°€ ë‹¤ë¥´ê²Œ ìƒì„±ë˜ì—ˆê±°ë‚˜, ì—´ ìˆœì„œê°€ ì–´ê¸‹ë‚˜ë©´ **statusê°€ ë¹ˆê°’**ì´ ë¨
- ë¹ˆê°’ì€ 'PENDING'ìœ¼ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ ì´ë¡ ì ìœ¼ë¡œëŠ” ë³´ì—¬ì•¼ í•˜ì§€ë§Œ...

#### ğŸ”´ ì›ì¸ C: ëŒ€ì‹œë³´ë“œ ë¡œë”© íƒ€ì´ë° ë¬¸ì œ

[`loadTelegramRequests()`](js-app.html:3860-3879)ëŠ”:
1. `loadDataAndRenderDashboard()` ì„±ê³µ í›„ì—ë§Œ í˜¸ì¶œë¨
2. `readAllDataWithImageIds()` ì™„ë£Œ â†’ ê·¸ ë‹¤ìŒ `listTelegramRequests('PENDING')` í˜¸ì¶œ
3. `readAllDataWithImageIds()`ê°€ **ë§¤ìš° ë¬´ê±°ìš´ í•¨ìˆ˜** (items ì „ì²´ + item_images ì „ì²´ ì½ê¸°)

```javascript
// readAllDataWithImageIds() ë‚´ë¶€:
var items = readAllData();           // items ì‹œíŠ¸ ì „ì²´ ì½ê¸°
var imgSheet = ss.getSheetByName(ITEM_IMAGES_SHEET_NAME);
var data = imgSheet.getRange(2, 1, imgSheet.getLastRow(), 5).getValues(); // item_images ì „ì²´ ì½ê¸°
```

**ì´ í•¨ìˆ˜ê°€ ì‹¤íŒ¨í•˜ê±°ë‚˜ íƒ€ì„ì•„ì›ƒë˜ë©´ `loadTelegramRequests()`ê°€ ì•„ì˜ˆ í˜¸ì¶œë˜ì§€ ì•ŠìŒ!**

#### ğŸŸ¡ ì›ì¸ D: í´ë§ ê°„ê²© ë¬¸ì œ

[`startTelegramRequestsPolling_()`](js-app.html:3796-3804):
```javascript
telegramRequestsPoller_ = setInterval(() => {
    const dash = document.getElementById('Dashboard');
    if (!dash || dash.classList.contains('content-hidden')) return;
    try { loadTelegramRequests(); } catch (e) { }
}, 15000); // 15ì´ˆ ê°„ê²©
```

- ëŒ€ì‹œë³´ë“œ íƒ­ì´ ë³´ì´ì§€ ì•Šìœ¼ë©´ í´ë§ì´ ìŠ¤í‚µë¨
- 15ì´ˆ ê°„ê²©ì´ë¯€ë¡œ ì‹¤ì‹œê°„ ë°˜ì˜ì´ ì•„ë‹˜
- **ëŒ€ì‹œë³´ë“œ íƒ­ì„ ì²˜ìŒ ì—´ ë•Œë§Œ** `loadTelegramRequests()` í˜¸ì¶œ

#### ğŸŸ¡ ì›ì¸ E: SpreadsheetApp.flush() ë¯¸í˜¸ì¶œ

ê²½ë¡œ 1(TelegramService.js)ì—ì„œ `appendRow()` í›„ `SpreadsheetApp.flush()`ë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ:
- GASëŠ” ìŠ¤í¬ë¦½íŠ¸ ì¢…ë£Œ ì‹œ ìë™ flushí•˜ì§€ë§Œ, **doPost()ê°€ ë¹¨ë¦¬ ëë‚˜ë©´ flushê°€ ì§€ì—°**ë  ìˆ˜ ìˆìŒ
- íŠ¹íˆ ë™ì‹œ ì ‘ê·¼ ì‹œ **ì“°ê¸° ë²„í¼ê°€ ì¶©ëŒ**í•  ìˆ˜ ìˆìŒ

---

## 4. ì „ì²´ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš° ë¶„ì„

### 4.1 ê´€ë¦¬ì â†’ íšŒì› ì „ì†¡ (ì •ìƒ í”Œë¡œìš°)

```
ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
    â†’ sendItemToMemberTelegramWithStyle(memberId, itemId, styleKey)
        â†’ getItemLiteById_(itemId)           // items ì‹œíŠ¸ 1ê±´ ì¡°íšŒ (ë¹ ë¦„)
        â†’ readAllMembers()                   // â˜… members ì‹œíŠ¸ ì „ì²´ ì½ê¸° (ëŠë¦¼)
        â†’ telegramBuildItemMessage_()        // ë©”ì‹œì§€ êµ¬ì„±
        â†’ telegramSendMessage()              // Telegram API ì „ì†¡
    â† { success: true }
```

**ë³‘ëª©**: [`readAllMembers()`](SheetDB.js:489) - ì „ì²´ íšŒì› ë°ì´í„°ë¥¼ ì½ì–´ì„œ `find()`ë¡œ ê²€ìƒ‰

### 4.2 íšŒì› â†’ ì„œë²„ (ì…ì°° ìš”ì²­ í”Œë¡œìš°)

```
íšŒì› í…”ë ˆê·¸ë¨
    â†’ ì…ì°°í™•ì • ë²„íŠ¼ í´ë¦­
    â†’ Telegram Webhook â†’ doPost()
        â†’ handleTelegramWebhook_(update)
            â†’ BID_CONFIRM: í™•ì¸ ë©”ì‹œì§€ ì „ì†¡ ("í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
    â†’ ì˜ˆ ë²„íŠ¼ í´ë¦­
    â†’ Telegram Webhook â†’ doPost()
        â†’ handleTelegramWebhook_(update)
            â†’ BID_YES:
                â†’ SpreadsheetApp.openById()
                â†’ items ì‹œíŠ¸ ê²€ìƒ‰ (TextFinder)
                â†’ telegram_requests ì‹œíŠ¸ì— appendRow
                â†’ telegramSendMessage() (ì‘ë‹µ)
                â†’ telegramDeleteMessage_() (í™•ì¸ ì‚­ì œ)
```

### 4.3 ëŒ€ì‹œë³´ë“œ í‘œì‹œ í”Œë¡œìš°

```
ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ íƒ­ í´ë¦­
    â†’ loadDataAndRenderDashboard()
        â†’ readAllDataWithImageIds()          // â˜…â˜…â˜… ë§¤ìš° ë¬´ê±°ì›€
            â†’ readAllData()                  // items ì „ì²´
            â†’ item_images ì „ì²´ ì½ê¸°
        â†’ (ì„±ê³µ í›„) loadTelegramRequests()
            â†’ listTelegramRequests('PENDING')
                â†’ telegram_requests ì‹œíŠ¸ ì „ì²´ ì½ê¸°
                â†’ items ì‹œíŠ¸ ì „ì²´ ì½ê¸° (JOIN)
            â†’ renderTelegramRequests_()
    â†’ startTelegramRequestsPolling_() (15ì´ˆ ê°„ê²©)
```

---

## 5. ë°œê²¬ëœ ë²„ê·¸ ë° ìœ„í—˜ ìš”ì†Œ

### ğŸ”´ Critical

| # | ìœ„ì¹˜ | ë¬¸ì œ | ì˜í–¥ |
|---|------|------|------|
| 1 | TelegramService.js:17 | `encodeURIComponent()`ê°€ ë´‡ í† í°ì˜ `:` ë¬¸ìë¥¼ ì¸ì½”ë”© | API í˜¸ì¶œ ì‹¤íŒ¨ ê°€ëŠ¥ |
| 2 | TelegramService.js:258-271 | `ensureTelegramRequestsSheet_()` ë¯¸ì‚¬ìš©, `flush()` ë¯¸í˜¸ì¶œ | ë°ì´í„° ë¶ˆì¼ì¹˜/ì§€ì—° |
| 3 | TelegramService.js:248 | `memberId`ë¥¼ items ì‹œíŠ¸ì—ì„œ ê°€ì ¸ì˜¤ëŠ”ë°, ë¹ˆê°’ì¼ ìˆ˜ ìˆìŒ | ìš”ì²­ì— member_id ëˆ„ë½ |
| 4 | js-app.html:3774-3777 | `loadTelegramRequests()`ê°€ `readAllDataWithImageIds()` ì„±ê³µì— ì˜ì¡´ | ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ìš”ì²­ ëª©ë¡ ë¯¸í‘œì‹œ |

### ğŸŸ¡ Warning

| # | ìœ„ì¹˜ | ë¬¸ì œ | ì˜í–¥ |
|---|------|------|------|
| 5 | TelegramService.js:520 | `readAllMembers()` ì „ì²´ ì½ê¸° | ì „ì†¡ ì‹œ ë¶ˆí•„ìš”í•œ ì§€ì—° |
| 6 | SheetDB.js:1061 | `listTelegramRequests()`ì—ì„œ 11ì—´ ê³ ì • ì½ê¸° | ì—´ ì¶”ê°€ ì‹œ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ |
| 7 | js-app.html:3799 | í´ë§ 15ì´ˆ ê°„ê²© | ì‹¤ì‹œê°„ì„± ë¶€ì¡± |
| 8 | ImageService.js:38 | `imgSheet.getLastRow()` ì‚¬ìš© (getLastRowê°€ ì•„ë‹Œ getLastRow()) | ë¹ˆ í–‰ í¬í•¨ ê°€ëŠ¥ |

### ğŸŸ¢ Info

| # | ìœ„ì¹˜ | ë¬¸ì œ |
|---|------|------|
| 9 | TelegramService.js:122-133 | CacheService ì¤‘ë³µ ë°©ì§€ëŠ” 6ì‹œê°„ TTL |
| 10 | Main.js:75 | doPost ì—ëŸ¬ ì‹œì—ë„ "OK" ë°˜í™˜ (Telegram ê¶Œì¥) |

---

## 6. ê°œì„  ê¶Œì¥ì‚¬í•­

### 6.1 ì¦‰ì‹œ ì ìš© (ê¸´ê¸‰)

#### A. `telegramApiUrl_()` ìˆ˜ì • - encodeURIComponent ì œê±°
```javascript
// Before (TelegramService.js:17)
return 'https://api.telegram.org/bot' + encodeURIComponent(getTelegramBotToken_()) + '/' + method;

// After
return 'https://api.telegram.org/bot' + getTelegramBotToken_() + '/' + method;
```
> ë´‡ í† í°ì€ URL-safe ë¬¸ìë§Œ í¬í•¨í•˜ë¯€ë¡œ ì¸ì½”ë”© ë¶ˆí•„ìš”. `:` ì¸ì½”ë”© ì‹œ API ì˜¤ë¥˜ ë°œìƒ.

#### B. BID_YES í•¸ë“¤ëŸ¬ì— `SpreadsheetApp.flush()` ì¶”ê°€
```javascript
// TelegramService.js:271 ì´í›„ì— ì¶”ê°€
reqSheet.appendRow([...]);
SpreadsheetApp.flush(); // â† ì¶”ê°€
```

#### C. ëŒ€ì‹œë³´ë“œì—ì„œ `loadTelegramRequests()`ë¥¼ ë…ë¦½ì ìœ¼ë¡œ í˜¸ì¶œ
```javascript
// js-app.htmlì˜ loadDataAndRenderDashboard() ìˆ˜ì •
// readAllDataWithImageIds() ì„±ê³µ/ì‹¤íŒ¨ì™€ ë¬´ê´€í•˜ê²Œ ìš”ì²­ ëª©ë¡ ë¡œë“œ
function loadDataAndRenderDashboard(forceRefresh = false) {
    // í…”ë ˆê·¸ë¨ ìš”ì²­ì€ í•­ìƒ ë…ë¦½ì ìœ¼ë¡œ ë¡œë“œ
    if (!IS_MEMBER_VIEW) {
        try { loadTelegramRequests(); } catch (e) { }
        try { startTelegramRequestsPolling_(); } catch (e) { }
    }
    // ... ê¸°ì¡´ ëŒ€ì‹œë³´ë“œ ë¡œë”© ë¡œì§ ...
}
```

### 6.2 ë‹¨ê¸° ê°œì„  (1-2ì¼)

#### D. `sendItemToMemberTelegramWithStyle()`ì—ì„œ `readAllMembers()` ëŒ€ì‹  ë‹¨ê±´ ì¡°íšŒ
```javascript
// í˜„ì¬: const members = readAllMembers(); // ì „ì²´ ì½ê¸°
// ê°œì„ : getMemberById_(targetMemberId) ê°™ì€ ë‹¨ê±´ ì¡°íšŒ í•¨ìˆ˜ ì‚¬ìš©
```

#### E. `handleTelegramWebhook_()` BID_YESì—ì„œ `ensureTelegramRequestsSheet_()` ì‚¬ìš©
```javascript
// í˜„ì¬: var reqSheet = ss.getSheetByName(TELEGRAM_REQUESTS_SHEET_NAME);
// ê°œì„ : var reqSheet = ensureTelegramRequestsSheet_();
// ë‹¨, openById ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€ë¥¼ ìœ„í•´ ss íŒŒë¼ë¯¸í„° ì „ë‹¬ ë°©ì‹ìœ¼ë¡œ ë¦¬íŒ©í† ë§
```

#### F. í´ë§ ê°„ê²© ë‹¨ì¶• ë˜ëŠ” WebSocket ëŒ€ì•ˆ
```javascript
// í˜„ì¬: 15000ms (15ì´ˆ)
// ê°œì„ : 5000ms (5ì´ˆ) ë˜ëŠ” Server-Sent Events í™œìš©
```

### 6.3 ì¤‘ì¥ê¸° ê°œì„ 

#### G. GAS ì½œë“œ ìŠ¤íƒ€íŠ¸ ë°©ì§€
- **ì‹œê°„ ê¸°ë°˜ íŠ¸ë¦¬ê±°**ë¡œ 5ë¶„ë§ˆë‹¤ ë”ë¯¸ í•¨ìˆ˜ ì‹¤í–‰í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ ìœ ì§€
```javascript
function keepAlive_() {
  // ë¹ˆ í•¨ìˆ˜ - ì¸ìŠ¤í„´ìŠ¤ ìœ ì§€ ëª©ì 
  CacheService.getScriptCache().get('keepalive');
}
// íŠ¸ë¦¬ê±°: 5ë¶„ë§ˆë‹¤ keepAlive_ ì‹¤í–‰
```

#### H. í…”ë ˆê·¸ë¨ ì‘ë‹µ ë¹„ë™ê¸°í™”
- `doPost()`ì—ì„œ ì¦‰ì‹œ "OK" ë°˜í™˜ í›„, ì‹¤ì œ ì²˜ë¦¬ëŠ” ë³„ë„ íŠ¸ë¦¬ê±°ë¡œ ì‹¤í–‰
- Telegram ì¬ì‹œë„ ë°©ì§€ + ì‘ë‹µ ì†ë„ ê°œì„ 

#### I. ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ëŒ€ì‹  Firebase/Cloud SQL ì‚¬ìš©
- í˜„ì¬ ëª¨ë“  ë°ì´í„°ê°€ Google Sheetsì— ì €ì¥ë˜ì–´ ìˆì–´ ë™ì‹œ ì ‘ê·¼ ì‹œ ë³‘ëª©
- ì½ê¸°/ì“°ê¸° ë¹ˆë„ê°€ ë†’ì€ `telegram_requests`ëŠ” ë³„ë„ DBë¡œ ë¶„ë¦¬ ê¶Œì¥

---

## 7. ìš”ì•½

| ë¬¸ì œ | ê·¼ë³¸ ì›ì¸ | ì‹¬ê°ë„ | í•´ê²° ë‚œì´ë„ |
|------|-----------|--------|-------------|
| ë©”ì‹œì§€ ì „ì†¡ 3ë¶„+ ì§€ì—° | GAS ì½œë“œ ìŠ¤íƒ€íŠ¸ + SpreadsheetApp I/O | ğŸ”´ ë†’ìŒ | ğŸŸ¡ ì¤‘ê°„ |
| DBì— ìˆì§€ë§Œ ëŒ€ì‹œë³´ë“œ ë¯¸í‘œì‹œ | loadTelegramRequests()ê°€ readAllDataWithImageIds() ì„±ê³µì— ì˜ì¡´ | ğŸ”´ ë†’ìŒ | ğŸŸ¢ ì‰¬ì›€ |
| encodeURIComponent í† í° ë¬¸ì œ | ë´‡ í† í° `:` ì¸ì½”ë”© | ğŸŸ¡ ì¤‘ê°„ | ğŸŸ¢ ì‰¬ì›€ |
| flush() ë¯¸í˜¸ì¶œ | ì“°ê¸° ì§€ì—° ê°€ëŠ¥ | ğŸŸ¡ ì¤‘ê°„ | ğŸŸ¢ ì‰¬ì›€ |
| readAllMembers() ì „ì²´ ì½ê¸° | ë¶ˆí•„ìš”í•œ ì „ì²´ ë°ì´í„° ë¡œë“œ | ğŸŸ¡ ì¤‘ê°„ | ğŸŸ¡ ì¤‘ê°„ |

**ê°€ì¥ ë¹ ë¥´ê²Œ íš¨ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ì¡°ì¹˜**:
1. âœ… ëŒ€ì‹œë³´ë“œì—ì„œ `loadTelegramRequests()`ë¥¼ ë…ë¦½ì ìœ¼ë¡œ í˜¸ì¶œ (ë¬¸ì œ 2 í•´ê²°)
2. âœ… `encodeURIComponent` ì œê±° (ì ì¬ì  API ì˜¤ë¥˜ ë°©ì§€)
3. âœ… `SpreadsheetApp.flush()` ì¶”ê°€ (ì“°ê¸° ì§€ì—° ë°©ì§€)
4. âœ… GAS keepAlive íŠ¸ë¦¬ê±° ì„¤ì • (ì½œë“œ ìŠ¤íƒ€íŠ¸ ë°©ì§€)
